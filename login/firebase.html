<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase Giriş</title>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js"></script>
  <!-- Firebase -->
</script>
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyAe6chXB01EfO52tQXebGIgwd-RNdj1aIk",
    authDomain: "lemon-software0.firebaseapp.com",
    projectId: "lemon-software0",
    storageBucket: "lemon-software0.firebasestorage.app",
    messagingSenderId: "850700843145",
    appId: "1:850700843145:web:3dba14b0091537013c2e58"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
</script>
</head>
<body>
  <h1>...</h1>
  <div id="error-message" style="color: red; display: none;"></div>

  <script>
    const auth = firebase.auth();

    // URL parametrelerini al
    const urlParams = new URLSearchParams(window.location.search);
    const command = urlParams.get('command');
    const email = urlParams.get('mail');
    const password = urlParams.get('password');

    // Hata mesajlarını gösterme fonksiyonu
    function showError(message) {
      const errorMessageElement = document.getElementById('error-message');
      errorMessageElement.textContent = message;
      errorMessageElement.style.display = 'block';
    }

    // Eğer "login" komutu varsa ve e-posta/şifre mevcutsa giriş yap
    if (command === 'login' && email && password) {
      auth.signInWithEmailAndPassword(email, password)
        .then(userCredential => {
          const user = userCredential.user;
          console.log("Giriş başarılı, kullanıcı ID'si: " + user.uid);

          // Kullanıcı ID'sini Local Storage'a kaydet
          localStorage.setItem('firebaseID', user.uid);

          // Giriş başarılı olduğunda mesaj gösterebiliriz
          alert('Giriş başarılı! Kullanıcı ID: ' + user.uid);

          // Sayfayı otomatik olarak kapat
          window.close();

          // Eğer sayfa kapanmazsa, kullanıcıya bilgi göster
          setTimeout(function() {
            if (!window.closed) {
              document.body.innerHTML = "<h1>Giriş başarılı, bu sekme kapatılabilir.</h1>";
            }
          }, 3000); // 3 saniye sonra kapatılabilir mesajı
        })
        .catch(error => {
          console.error("HATA: " + error.message);
          showError("HATA: " + error.message); // Hata mesajını ekranda göster
        });
    } else {
      console.log("Geçersiz komut veya eksik parametreler.");
      showError("Geçersiz komut veya eksik parametreler.");
    }
  </script>
</body>
</html>
